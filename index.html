<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FMS ì‹œì„¤ë¬¼ ê´€ë¦¬ì‹œìŠ¤í…œ</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
    <div class="max-w-6xl mx-auto p-6">
        <!-- í—¤ë” -->
        <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
            <h1 class="text-3xl font-bold text-gray-900 mb-2">ğŸ”— FMS ì‹œì„¤ë¬¼ ê´€ë¦¬ì‹œìŠ¤í…œ</h1>
            <p class="text-gray-600">ìˆœìˆ˜ JavaScriptë¡œ êµ¬í˜„ëœ í™•ì‹¤í•œ CSV ê²€ìƒ‰ ì‹œìŠ¤í…œ</p>
            
            <!-- ìƒíƒœ í‘œì‹œ -->
            <div id="status" class="mt-4 p-3 rounded-lg">
                <div class="flex items-center gap-2">
                    <div class="w-3 h-3 bg-yellow-500 rounded-full animate-spin"></div>
                    <span class="text-yellow-700 font-medium">CSV ë°ì´í„° ë¡œë”© ì¤‘...</span>
                </div>
            </div>
        </div>

        <!-- ê²€ìƒ‰ ì„¹ì…˜ -->
        <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
            <h2 class="text-xl font-bold mb-4">ğŸ” ì„¤ë¹„ ê²€ìƒ‰</h2>
            <div class="flex gap-3 mb-4">
                <input 
                    type="text" 
                    id="searchInput" 
                    placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."
                    class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    disabled
                >
                <button 
                    id="searchBtn" 
                    class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed"
                    disabled
                >
                    ê²€ìƒ‰
                </button>
            </div>
            
            <!-- ë¹ ë¥¸ ê²€ìƒ‰ ë²„íŠ¼ -->
            <div class="flex gap-2 flex-wrap">
                <button class="quick-search px-3 py-1 bg-gray-200 text-gray-700 rounded hover:bg-gray-300" data-term="SC01">SC01</button>
                <button class="quick-search px-3 py-1 bg-gray-200 text-gray-700 rounded hover:bg-gray-300" data-term="ë³´ì¼ëŸ¬">ë³´ì¼ëŸ¬</button>
                <button class="quick-search px-3 py-1 bg-gray-200 text-gray-700 rounded hover:bg-gray-300" data-term="ì „ê¸°">ì „ê¸°</button>
                <button class="quick-search px-3 py-1 bg-gray-200 text-gray-700 rounded hover:bg-gray-300" data-term="ì§€í•˜">ì§€í•˜</button>
                <button class="quick-search px-3 py-1 bg-gray-200 text-gray-700 rounded hover:bg-gray-300" data-term="2021">2021</button>
            </div>

            <!-- ë°ì´í„° ì •ë³´ -->
            <div id="dataInfo" class="mt-4 text-sm text-gray-600"></div>
        </div>

        <!-- ê²€ìƒ‰ ê²°ê³¼ -->
        <div id="results" class="space-y-4"></div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let csvData = [];
        let isLoading = false;

        // DOM ìš”ì†Œ
        const statusEl = document.getElementById('status');
        const searchInput = document.getElementById('searchInput');
        const searchBtn = document.getElementById('searchBtn');
        const resultsEl = document.getElementById('results');
        const dataInfoEl = document.getElementById('dataInfo');
        const quickSearchBtns = document.querySelectorAll('.quick-search');

        // ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateStatus(type, message, details = '') {
            const colors = {
                loading: 'bg-yellow-50 border-yellow-200 text-yellow-700',
                success: 'bg-green-50 border-green-200 text-green-700',
                error: 'bg-red-50 border-red-200 text-red-700'
            };
            
            const icons = {
                loading: '<div class="w-3 h-3 bg-yellow-500 rounded-full animate-spin"></div>',
                success: '<div class="w-3 h-3 bg-green-500 rounded-full"></div>',
                error: '<div class="w-3 h-3 bg-red-500 rounded-full"></div>'
            };

            statusEl.className = `mt-4 p-3 rounded-lg border ${colors[type]}`;
            statusEl.innerHTML = `
                <div class="flex items-center gap-2">
                    ${icons[type]}
                    <span class="font-medium">${message}</span>
                </div>
                ${details ? `<div class="mt-2 text-sm">${details}</div>` : ''}
            `;
        }

        // CSV ë¡œë“œ ë° íŒŒì‹±
        async function loadCSVData() {
            try {
                console.log('ğŸš€ CSV ë¡œë”© ì‹œì‘...');
                updateStatus('loading', 'CSV íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...');
                
                const response = await fetch('./data.csv');
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const csvText = await response.text();
                console.log('ğŸ“„ CSV í¬ê¸°:', csvText.length, 'ë°”ì´íŠ¸');
                
                // ë‹¤ì–‘í•œ êµ¬ë¶„ìë¡œ íŒŒì‹± ì‹œë„
                const separators = [',', ';', '\t', '|'];
                let bestResult = { data: [], separator: '', count: 0 };
                
                for (const sep of separators) {
                    try {
                        const result = parseCSV(csvText, sep);
                        console.log(`ğŸ“Š ${sep === ',' ? 'ì½¤ë§ˆ' : sep === ';' ? 'ì„¸ë¯¸ì½œë¡ ' : sep === '\t' ? 'íƒ­' : 'íŒŒì´í”„'} êµ¬ë¶„ì: ${result.length}ê°œ`);
                        
                        if (result.length > bestResult.count) {
                            bestResult = { data: result, separator: sep, count: result.length };
                        }
                    } catch (e) {
                        console.log(`âŒ ${sep} êµ¬ë¶„ì ì‹¤íŒ¨:`, e.message);
                    }
                }
                
                if (bestResult.count === 0) {
                    throw new Error('ì–´ë–¤ êµ¬ë¶„ìë¡œë„ ë°ì´í„°ë¥¼ íŒŒì‹±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                }
                
                csvData = bestResult.data;
                console.log('âœ… ìµœì¢… ë°ì´í„°:', csvData.length, 'ê°œ');
                console.log('ğŸ” ì²« ë²ˆì§¸ ë°ì´í„°:', csvData[0]);
                
                updateStatus('success', `âœ… CSV ë°ì´í„° ë¡œë“œ ì„±ê³µ!`, 
                    `ì´ ${csvData.length}ê°œ ë°ì´í„° â€¢ êµ¬ë¶„ì: ${bestResult.separator === ',' ? 'ì½¤ë§ˆ(,)' : bestResult.separator === ';' ? 'ì„¸ë¯¸ì½œë¡ (;)' : bestResult.separator === '\t' ? 'íƒ­' : 'íŒŒì´í”„(|)'}`
                );
                
                // ê²€ìƒ‰ í™œì„±í™”
                searchInput.disabled = false;
                searchBtn.disabled = false;
                quickSearchBtns.forEach(btn => btn.disabled = false);
                
                // ë°ì´í„° ì •ë³´ í‘œì‹œ
                if (csvData.length > 0) {
                    const headers = Object.keys(csvData[0]);
                    dataInfoEl.innerHTML = `
                        <div><strong>ì»¬ëŸ¼:</strong> ${headers.slice(0, 5).join(', ')}${headers.length > 5 ? ` ì™¸ ${headers.length - 5}ê°œ` : ''}</div>
                        <div><strong>ê²€ìƒ‰ ê°€ëŠ¥:</strong> ëª¨ë“  í•„ë“œì—ì„œ í†µí•© ê²€ìƒ‰</div>
                    `;
                }
                
            } catch (error) {
                console.error('âŒ CSV ë¡œë“œ ì˜¤ë¥˜:', error);
                updateStatus('error', 'âŒ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨', error.message);
            }
        }

        // CSV íŒŒì‹± í•¨ìˆ˜
        function parseCSV(csvText, separator) {
            const lines = csvText.split('\n').map(line => line.trim()).filter(line => line.length > 0);
            
            if (lines.length < 2) {
                throw new Error('ë°ì´í„°ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤');
            }
            
            // í—¤ë” íŒŒì‹±
            const headers = lines[0].split(separator).map(h => h.replace(/^"|"$/g, '').trim());
            
            if (headers.length < 2) {
                throw new Error('ì¶©ë¶„í•œ ì»¬ëŸ¼ì´ ì—†ìŠµë‹ˆë‹¤');
            }
            
            // ë°ì´í„° íŒŒì‹±
            const data = [];
            for (let i = 1; i < lines.length; i++) {
                const values = lines[i].split(separator).map(v => v.replace(/^"|"$/g, '').trim());
                
                if (values.length >= Math.max(2, headers.length - 3)) { // ê´€ëŒ€í•œ ê²€ì¦
                    const row = {};
                    headers.forEach((header, index) => {
                        row[header] = values[index] || '';
                    });
                    
                    // ìœ íš¨í•œ ë°ì´í„°ì¸ì§€ í™•ì¸
                    if (Object.values(row).some(v => v && v.length > 0)) {
                        data.push(row);
                    }
                }
            }
            
            if (data.length === 0) {
                throw new Error('ìœ íš¨í•œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤');
            }
            
            return data;
        }

        // ê²€ìƒ‰ í•¨ìˆ˜
        function performSearch(term) {
            if (!term || !term.trim()) {
                resultsEl.innerHTML = '';
                return;
            }
            
            console.log('ğŸ” ê²€ìƒ‰ ì‹œì‘:', term);
            const searchTerm = term.toLowerCase();
            
            // ê²€ìƒ‰ ì‹¤í–‰
            const results = csvData.filter(row => {
                return Object.values(row).some(value => 
                    value && value.toString().toLowerCase().includes(searchTerm)
                );
            });
            
            console.log('ğŸ“‹ ê²€ìƒ‰ ê²°ê³¼:', results.length, 'ê°œ');
            
            // ê²°ê³¼ í‘œì‹œ
            displayResults(results, term);
        }

        // ê²°ê³¼ í‘œì‹œ í•¨ìˆ˜
        function displayResults(results, searchTerm) {
            if (results.length === 0) {
                resultsEl.innerHTML = `
                    <div class="bg-white rounded-lg shadow-sm p-8 text-center">
                        <div class="text-4xl mb-4">ğŸ”</div>
                        <h3 class="text-lg font-bold text-gray-600 mb-2">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</h3>
                        <p class="text-gray-500">"${searchTerm}"ì— ëŒ€í•œ ê²°ê³¼ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</p>
                    </div>
                `;
                return;
            }
            
            const html = `
                <div class="bg-white rounded-lg shadow-sm p-4 mb-4">
                    <h3 class="text-lg font-bold text-blue-600">ğŸ“‹ ê²€ìƒ‰ ê²°ê³¼ (${results.length}ê±´)</h3>
                    <p class="text-sm text-gray-600">"${searchTerm}" ê²€ìƒ‰ ê²°ê³¼</p>
                </div>
                ${results.slice(0, 20).map((row, index) => {
                    const values = Object.values(row);
                    const keys = Object.keys(row);
                    
                    return `
                        <div class="bg-white rounded-lg shadow-sm p-5 border-l-4 border-blue-500">
                            <div class="flex items-start gap-4">
                                <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0">
                                    <span class="text-blue-600 font-bold">${index + 1}</span>
                                </div>
                                <div class="flex-1">
                                    <h4 class="font-bold text-lg text-gray-900 mb-2">${values[0] || `í•­ëª© ${index + 1}`}</h4>
                                    <div class="text-gray-700 mb-3">${values[1] || values[2] || 'ìƒì„¸ì •ë³´ ì—†ìŒ'}</div>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-2 text-sm text-gray-600 mb-3">
                                        ${values.slice(2, 6).filter(v => v).map(v => `<div>â€¢ ${v}</div>`).join('')}
                                    </div>
                                    <details class="text-xs">
                                        <summary class="cursor-pointer text-blue-600 hover:text-blue-800 mb-2">ì „ì²´ ë°ì´í„° ë³´ê¸°</summary>
                                        <div class="bg-gray-50 p-3 rounded text-xs font-mono overflow-x-auto">
                                            ${Object.entries(row).map(([k, v]) => `<div><strong>${k}:</strong> ${v}</div>`).join('')}
                                        </div>
                                    </details>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('')}
            `;
            
            resultsEl.innerHTML = html;
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        searchBtn.addEventListener('click', () => {
            performSearch(searchInput.value);
        });

        searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                performSearch(searchInput.value);
            }
        });

        quickSearchBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                const term = btn.dataset.term;
                searchInput.value = term;
                performSearch(term);
            });
        });

        // í˜ì´ì§€ ë¡œë“œ ì‹œ CSV ë°ì´í„° ë¡œë“œ
        window.addEventListener('load', loadCSVData);
    </script>
</body>
</html>
